TODO
----

NEW CALIBRATION BUGS:

- ha vilagos a hatter, pl. hold bevilagit, akkor a kalibracio furan vonja le a flat-et

	- photutils le tudja vonnia hatteret

	>>> sudo pip3 install photutils

(533) !!! Hibás kalibráció, de nincs hibaüzenet, csak az eredmény képből derül ki, hogy rossz volt a regisztráció.

	- ugy tunik, hogy a background levonas megoldja

(527) calib: 20200404: kalibracio hibas

	ficalib: error: dark image size differs from the expected image size.

	A dark keppel lesz valami gond, a 20200331-i darkkal jo

- amikor egy kulso program hibat ad vissza, akkor a hibauzenet utan a parancssort is irjuk ki


NEW PHOTOMETRY BUGS:

- !!! 20200404_bc_uma eseteben hmg-re 20.2 mg-t adott, hibara 4.195-ot

- !!! ppl-refcat elszall coord lekerdezesre:

	Traceback (most recent call last):
	  File "/home/kovi/bin/ppl-refcat", line 512, in <module>
	    app.run()
	  File "/home/kovi/bin/ppl-refcat", line 503, in run
	    cat.execute()
	  File "/home/kovi/bin/ppl-refcat", line 334, in execute
	    s_ra = deg2hexa(float(self.opt['ra']) / 15.0)
	ValueError: could not convert string to float: '08:51:18'

- !!! aavso result: mintha az osszes ERR_x ugyan az az ertek lenne

	a .pm file-okban is igy van

(521) !!! pmphot: elszall, ha az osszes V oh hibaja 0.0 (20090717_v443_lyr)

	Traceback (most recent call last):
	  File "/home/kovi/bin/ppl-photometry", line 341, in <module>
	    app.run()
	  File "/home/kovi/bin/ppl-photometry", line 332, in run
	    ppl.execute()
	  File "/home/kovi/bin/ppl-photometry", line 176, in execute
	    success = self.process_photometry(sf, pf, "PHOTOMETRY")
	  File "/home/kovi/bin/ppl-photometry", line 142, in process_photometry
	    self.calculateMags(photFolder, self.opt['color'])
	  File "/home/kovi/bin/ppl-photometry", line 118, in calculateMags
	    phot.process()
	  File "/home/kovi/bin/pmphot.py", line 781, in process
	    bestComp = self.findBestCompStar(allCatalogs, color)  # refcat record of best comp in Gi
	  File "/home/kovi/bin/pmphot.py", line 397, in findBestCompStar
	    bestComp[rolePos] = 'K'
	TypeError: 'NoneType' object does not support item assignment


(520) !!! pmphot: elszall, ha nincs R mg. Kellene valami vizsgalat, hogy ha all color lett megadva, hogy az oh-k jok-e ehhez. 
	Ha hianyzik mondjuk az R mag, akkor vagy kapcsoljon at ketszin fotometriara, vagy irjon ki hibauzenetet

	Traceback (most recent call last):
	  File "/home/kovi/bin/ppl-photometry", line 341, in <module>
	    app.run()
	  File "/home/kovi/bin/ppl-photometry", line 332, in run
	    ppl.execute()
	  File "/home/kovi/bin/ppl-photometry", line 176, in execute
	    success = self.process_photometry(sf, pf, "PHOTOMETRY")
	  File "/home/kovi/bin/ppl-photometry", line 142, in process_photometry
	    self.calculateMags(photFolder, self.opt['color'])
	  File "/home/kovi/bin/ppl-photometry", line 118, in calculateMags
	    phot.process()
	  File "/home/kovi/bin/pmphot.py", line 792, in process
	    coeffs = self.calculateCoeffs(mergedCat)
	  File "/home/kovi/bin/pmphot.py", line 612, in calculateCoeffs
	    V_R.append(float(row[2]) - float(row[3]))
	ValueError: could not convert string to float: '-'


(529) !!! pmphot: linfit elszall, ha 1 vagy 0 elem van a listakban

- !!! pmfilter: hmg szamitas felulvizsgalata

(526) STD: ha valamelyik szinben fainter, akkor ne csinaljon std-t, legfeljebb 2 szinben

NEW IDEAS:

-NEW: OSBERVER fits header, ha van, akkor ezt lehet hasznalni a -n opcio helyett

- colorize: ha vilagos a hatter, pl. hold vilagit, akkor a kep osszerakasnal kell egy hatter modellezes, es azt levonni

- calib: kell valami eszkoz a kalibracios kepek minosegenek ellenorzesere, es ezt ki is kell iratni, 
	es ha nem olyan jo a minoseg, akkor jelezni

(530) a ppl-setup keruljon be a .pmlib-be, es legyen altalanos formatumu

- pmphot: a hmg-t is kiirathatna valodi mg-ben, ezt akar a fits-be is betehetne

- more standard areas:

	https://www.aavso.org/apps/vsd/stdfields

	https://www.aavso.org/apps/vsp/chart/?title=NGC%201252&ra=47.704167&dec=-57.766667&fov=120&maglimit=14.5&special=std_field&B=on&Rc=on&Ic=on&north=down&east=right

	https://www.aavso.org/apps/vsp/photometry/?fov=15&B=on&north=down&maglimit=16&title=M11&ra=282.77292&Rc=on&Ic=on&east=right&dec=-6.266667&special=std_field

	AAVSO VSP:

	Table 6.1 – Standard clusters
	Name              RA       Dec       Mag Range Diameter(arc min)	Comps
	/NGC 1252          03:10:49 -57:46:00 8 – 15    300+			36
	M67               08:51:18 +11:48:00 7 – 16    74			211
	/NGC 3532          11:05:39 -58:45:12 8 – 13.5  30			288
	Coma Star Cluster 12:22:30 +25:51:00 5 – 10    450			92	Melotte 111
	M11               18:51:05 -06:16:12 8.5 – 17  20			416
	NGC 7790          23:58:23 +61:12:25 10 – 20   7			218

	SA20		  01	   +45			40			23
	SA23		  04	   +45			30			16
	SA26		  07	   +45               	30			16
	SA29		  10	   +45			60			15
	SA32		  13	   +45			60			22
	SA35		  16	   +45			40			18
	SA38		  19	   +45			20			16
	SA41		  22	   +45			30			13

- cosmetic: less output from photometry (sextractor) apps

- PPLSERVER: katalogus automatikus keszitese - a pplserver-en csak erre van lehetoseg
	a kep koordinataja alapjan keszitsen refcat-ot
	a refcat neve vagy a koordinata valamilyen kerekitessel (hogy ne csinaljon minden kis elteresre kulon file-t),
		vagy ha a kep kozepen valameilyen pontossaggal van valtozo, akkor annak a neve
	feltoltott csoportonkent csak egy refcat keszuljon (ez pplserver igeny)

- kell egy script, ami osszegyujti az aavso riportokat egybe, a fokonyvtarba

TECH UPGRADE:

- colorize: astropy.visualization normalizalas

- photutils hasznalata: https://photutils.readthedocs.io/en/stable/index.html

- refcat: astropy.io.votable - egyszerubb votable kezeles 

- Katalogus kezeles astropy.table.Table segitsegevel

	pmphot, pmresult

- SCAMP: grmatch helyett

- fiphot: sextractor helyett

	# Common arguments (saturation level, image section & trimming, etc.):
	FISTAR_ARGS="--algorithm uplink --prominence 0.0 --model elliptic --format id,x,y,s,d,k,amp,flux"
	FIPHOT_ARGS="--col-xy 2,3 --col-id 1 --mag-flux 10,10000 --aperture 7:12:15 --disjoint-annuli --sky-fit mode,iterations=4,sigma=3 --format ISXY,MmBbFfXxYy --comment"

	# Photometry of the source images:
	for f in ${SEQLIST[*]:1} ; do

	  echo "photometry of $f"
	  fstars="${TEMPDIR}/`basename $f`.stars"

	  fistar $f $FISTAR_ARGS -o $fstars

	  fiphot $f --input-list $fstars $FIPHOT_ARGS --output ${TEMPDIR}/`basename $f`.phot

	done

	grcollect ${TEMPDIR}/${SEQ_FILE_PREFIX}*.phot --col-base 2 --prefix ${TEMPDIR}/ --extension lc --max-memory 256m


=== V 1.1 ==================================================

(476) output control arguments: -v | --verbose, -d | --debug, -q | --quiet

	- printDebug()

	- esetleg Print/Log class, Print.info(), etc. metodusokkal, init-ben log mode

	- normalis esetben file-ba os logolhatna, akkor megmaradna a hiba is

	- invoke hiba eseten, a valaszt is logolni kellene

--- calibration --------------------------------------------

(490) Flat library

(459) Dark library kezelés

--- photometry ---------------------------------------------

(518) pmphot: ha keves a comp star a refcat-ban, es adhoc std, make-std vagy ensemble lenne, irjon figyelmeztetest, hogy ehelyett comp mg kellene

(450) !!! standardization (s15n)

	- !!! a comp star szamolast es a std keszitest szet kell valasztani:

		1. hatarozza meg a polinomot comp/gcx/lfit modszerrel

		2. szamoljon comp mC, eC ertekeket

		3. szamoljon var mC, eC ertekeket instr/std modszerrel

		method		std		result

		comp		none		normal inst mg			kevés comp esetén

				use		normal std mg			kevés comp és létező coeffs esetén, adhoc nem lehetséges
				
		gcx/lfit	none		ensemble inst mg		sok comp esetén

				use		ensemble std mg			sok comp és létező coeffs esetén


	- ha valamelyik szinben nem latszik, vagy tul nagy a hibaja, mert halvany, akkor lehet, hogy nem kellene std mg-t szamolni ra, csak sima comp TG/TB/TR erteket

	+ best comp star kepernyo kiiratasnal rossz a hiba erteke: 0.2

	- az RX Lyr a nem std modszerekkel fainter lett, std-vel nem. Nem veszi figyelembe a hmg-t?
		az std rendben van, a tobbit kell megnezni

	- !!! mentes coeff file-ba

		- ha ujra ugyan azt a kepet dolgozza fel, akkor ne irjon uj rekordot a coeff file-ba
		  overwrite modban update-elje az ertekeket

		- hianyzo adatok: +observer, +image date, +camera, +telescope, field

			+ a kamera/tavcso adatok keruljenek defaultban a ppl-setup-ba, de legzen opcio a felulirasara.
			  a feldolgozas nezze meg, hogy benne van-e a fits-ben, ha ott van, akkor azt hasznalja

		- calculate coeff errors

		+ kellene az eszlelo nevet is tarolni, ha a pplserver felhasznalast nezzuk

		? ha egy nap tobb coff keszul, akkor az utolso felulirja az elozot, 
			vagy atlagoljuk oket? utobbi esetben el kell tarolni, hogy hany adatbol keszult, azzel lehet atlagolni



	- average coeff szamolasa

	- fits es cat/pm tartalmazza a coeff infokat

	+ SA catalogs

	+ refcat kezelje a SA nevu objektumokat


(449) hot and dead pixel removing with fiign


=== V 1.2 ==================================================

(465) RAW képek és eredmény archiválása

--- calibration --------------------------------------------

(528) calib: overwrite modban, ha flat is van, de nincs flat-bias es flat-dark, a master-bias es a master-dark 2x keszul el

--- photometry ---------------------------------------------

(522) kappa-sigma iteracio egyenes illesztesnel

	- mg calc: lfit - legyen itt is kappa-sigma iteracio, lehet, hogy lfit egyaltalan nem kell

	- mg calc: coeff szamolasnal is legyen kappa-sigma iteracio ???

(510) PSF fotometria ködös objektumok esetén

(489) Referencia katalógus tartalmazzon mezőcsillagokat is

(488) Tranziens detektálás

(451) whole frame photometry

=== V 2.0 ==================================================

(532) autoclean: lehetne egy kapcsolo, hogy a feldolgozas vegen tol egy clean-t, es csak az eredmeny file-ok maradnak meg

(493) Szűrő nélküli CCD képek kezelése

(469) config: tetszoleges parameter megadhato legyen command line-ban

	pl: -D max-distance=4

	COMMON_ARGS:
		saturation nnn
	FISTAR_ARGS:
		algorithm [uplink]
		prominence fff.f
		model [elliptic]
	GRMATCH_ARGS:
		triangulation maxinp=100,maxref=100,conformable,auto,unitarity=0.002
		order nnn
		max-distance nnn
	FICOMBINE_ARGS:
		m [sum] (combination algorithm)

(453) FITS headerek

--- calibration --------------------------------------------

(515) COLORIZE: 20090717_nsv_11154 eseteben elszall sqrt modban, linearban ok
	Traceback (most recent call last):
	  File "/home/kovi/bin/ppl-colorize", line 148, in <module>
	    app.run()
	  File "/home/kovi/bin/ppl-colorize", line 140, in run
	    col.execute()
	  File "/home/kovi/bin/ppl-colorize", line 77, in execute
	    imsave(imgFileName, img)
	  File "/home/kovi/.local/lib/python3.6/site-packages/matplotlib/image.py", line 1496, in imsave
	    rgba = sm.to_rgba(arr, bytes=True)
	  File "/home/kovi/.local/lib/python3.6/site-packages/matplotlib/cm.py", line 271, in to_rgba
	    raise ValueError("Floating point image RGB values "
	ValueError: Floating point image RGB values must be in the 0..1 range.

	elszallt meg:

		20090717_es_aql
		20090719/cy_lyr
		20090719/fh_sct

(502) Ha a valamelyik kep nem match-el, es szekvenciat adunk ossze, akkor nem lesz jo a szekvencia, 
	elcsuszik, es a szinek is elcsusznak egymashoz kepes
	A pythonos verzioban a szekvencia szamolaskor ezt figyelembe kell venni, a szekvenciabol kihagyni

(501) Utility: regisztráció és stackelés

(448) Create/use 3D/4D FITS

(472) A RAW -> FITS konverziónál ne csak CR2 file-okat tudjon konvertálni

--- photometry ---------------------------------------------

(516) AST: 20090717_ez_aql eseteben sikertelen az asztrometria, B es G szinben, R-ben is eszmeletlen sokaig tart

(491) Két szín fotometria

(461) Fénygörbe készítése

=== NOT VERSIONED  ==================================================

(535) ppl-refcat: legyen olyan opció, hogy az objektum nevét a könyvtárnévből találja ki

	opcio: -g --guess, ha nem siker-l a konyvtarnevbol meghatarozni, akkor a kordinatabol csinalja

(534) ppl-refcat: ha coord volt megadva, akkor nézze meg, hogy a változók között van-e olyan, ami elég közel esik a kép közepéhez, és inkább ez legyen a catalog neve.

(525) colorize: a megtalalt csillagokat ra kellene rajzolni a kepre, foleg a valtozokat, meg az oh-kat, ez a tranziens-keresesnel lesz fontos
	- ezt a colorize csinalja? ez lenne a legjobb
	- csinalunk rd2xy transzformaciot, az alapjan be tudja rajzolni a vonalakat
	- com star legyen sarga, a valtozo feher

(482) a command mentes file (calibration, photometry) futtathato script legyen (shebang, cd az indito konyvtarra)	

--- calibration --------------------------------------------

(531) calibration: ha a Seq folderben letezik Combined, akkor ne hozza oket letre csak overwritetal

(492) Szintetikus bias, dark és flat képek használata

(473) Master flat kép analízis

(471) Gi csatornák összegzése átlagolás helyett

--- photometry ---------------------------------------------

(517) szaturalt csillagok kezelese, ha tul fenyes a csillag, akkor nem szabad fotometralni, se comp starnak hasznalni
	ezt a kappa-sigma kimutatja?

	- tudjuk-e valahogy megmerni a szaturacios szintet, es flagelni a szaturalt csillagokat

(514) AST: az astrometriat ugy kellene parameterezni, hogy a sextractor a megfelelo outputot adja,
	es ne kelljen meg egyszer meghivni

(513) AST: egy objektum fotometralasanal, az elso kepbol ki kell szedni a koordinatakat (CRVAL1, CRVAl2), 
	es felhasznalni a tobbi kepnel hintnek.


